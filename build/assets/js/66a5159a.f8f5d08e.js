"use strict";(self.webpackChunksf_documentation=self.webpackChunksf_documentation||[]).push([[2246],{3905:function(e,n,t){t.d(n,{Zo:function(){return m},kt:function(){return d}});var a=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var s=a.createContext({}),p=function(e){var n=a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},m=function(e){var n=p(e.components);return a.createElement(s.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},c=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,m=l(e,["components","mdxType","originalType","parentName"]),c=p(t),d=r,g=c["".concat(s,".").concat(d)]||c[d]||u[d]||i;return t?a.createElement(g,o(o({ref:n},m),{},{components:t})):a.createElement(g,o({ref:n},m))}));function d(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var i=t.length,o=new Array(i);o[0]=c;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var p=2;p<i;p++)o[p]=t[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}c.displayName="MDXCreateElement"},3292:function(e,n,t){t.r(n),t.d(n,{assets:function(){return m},contentTitle:function(){return s},default:function(){return d},frontMatter:function(){return l},metadata:function(){return p},toc:function(){return u}});var a=t(3117),r=t(102),i=(t(7294),t(3905)),o=["components"],l={},s="Monitoring JAVA applications running in Kubernetes",p={unversionedId:"Integrations/java/java_kubernetes",id:"Integrations/java/java_kubernetes",title:"Monitoring JAVA applications running in Kubernetes",description:"Overview",source:"@site/docs/Integrations/java/java_kubernetes.md",sourceDirName:"Integrations/java",slug:"/Integrations/java/java_kubernetes",permalink:"/docs/Integrations/java/java_kubernetes",editUrl:"https://github.com/ram-dot-kumar/SFwebsite.git/docs/Integrations/java/java_kubernetes.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Monitoring JAVA applications running on Instances",permalink:"/docs/Integrations/java/java_instances"},next:{title:"CPU Profiling",permalink:"/docs/Integrations/java/java_profiler_cpu"}},m={},u=[{value:"Overview",id:"overview",level:2},{value:"Java monitoring with sfKubeAgent",id:"java-monitoring-with-sfkubeagent",level:2},{value:"Prerequisites",id:"prerequisites",level:3},{value:"Configurations",id:"configurations",level:3},{value:"Viewing data and dashboards",id:"viewing-data-and-dashboards",level:3},{value:"Troubleshooting",id:"troubleshooting",level:3},{value:"JVM Monitoring with Prometheus exporter",id:"jvm-monitoring-with-prometheus-exporter",level:2},{value:"Pre-requisites",id:"pre-requisites",level:3},{value:"Configurations",id:"configurations-1",level:3},{value:"Viewing data and dashboards",id:"viewing-data-and-dashboards-1",level:3},{value:"Troubleshooting",id:"troubleshooting-1",level:3}],c={toc:u};function d(e){var n=e.components,t=(0,r.Z)(e,o);return(0,i.kt)("wrapper",(0,a.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"monitoring-java-applications-running-in-kubernetes"},"Monitoring JAVA applications running in Kubernetes"),(0,i.kt)("h2",{id:"overview"},"Overview"),(0,i.kt)("p",null," Java\u202fapplications\u202frunning\u202fin\u202fKubernetes\u202fcan\u202fbe\u202fmonitored\u202fin\u202fSnappyFlow\u202fusing\u202ftwo\u202fapproaches: "),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/docs/integrations/kubernetes/sfkubeagent_installation"},"sfKubeAgent"),"\u202fas\u202fsidecar\u202fcontainer. "),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/docs/integrations/kubernetes/prometheus_exporter"},"Prometheus\u202fexporter")," ")),(0,i.kt)("h2",{id:"java-monitoring-with-sfkubeagent"},"Java monitoring with sfKubeAgent"),(0,i.kt)("p",null,"In this option, the Java application should be run with Jolokia agent and sfKubeAgent running as a sidecar container and fetches metrics via Jolokia port. Refer to ",(0,i.kt)("a",{parentName:"p",href:"/docs/integrations/kubernetes/sfkubeagent_installation"},"sfKubeAgent")," Overview "),(0,i.kt)("h3",{id:"prerequisites"},"Prerequisites"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Copy Jolokia JAR into docker image ")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Run the java application with Jolokia JAR in docker image:"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"-javaagent:/<path_jolokia_jar>/jolokia-jvm-<version>-agent.jar  \n")))),(0,i.kt)("h3",{id:"configurations"},"Configurations"),(0,i.kt)("p",null,"Run sfKubeAgent with JVMJolokia plugin, which is specified using the config map shown below: "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: v1 \nkind: ConfigMap \nmetadata: \nname: jvm-configmap \ndata: \nconfig.yaml: |- \nkey: <profile_key> \nmetrics: \nplugins: \nname: jvmjolokia \nenabled: true \ninterval: 300 config: \nip: 127.0.0.1 \nprotocol: http \nport: <userDefinedJolokiaPort> \ncontext: jolokia \nmonitorDeadlocks: false \ndeadLockMonitoringInterval: 300 \n")),(0,i.kt)("p",null,"The example illustrates instantiating sfKubeAgent with jvm-configmap. sfAKubeAgent talks to the Java application via userDefinedJolokiaPort (this example used 8778) "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"kind: Pod \napiVersion: v1 \nmetadata: \nname: my-first-pod-1 \nlabels: \nsnappyflow/appname: <app_name> \nsnappyflow/projectname: <project_name> \nspec:\ncontainers: \nname: java-container \nimage: <docker_id>/<docker_image>:<tag> ports: \nname: jolokiaport \ncontainerPort: <userDefinedJolokiaPort> \nSnappyflow's sfkubeagent container \nname: java-sfagent \nimage: snappyflowml/sfagent:latest \nimagePullPolicy: Always command: \n/app/sfagent \n-enable-console-log \nenv: \nname: APP_NAME \nvalue: <app_name> \nname: PROJECT_NAME \nvalue: <project_name> \nvolumeMounts: \nname: configmap-jvm \nmountPath: /opt/sfagent/config.yaml \nsubPath: config.yaml \nvolumes: \nname: configmap-jvm configMap: \nname: jvm-configmap \n")),(0,i.kt)("h3",{id:"viewing-data-and-dashboards"},"Viewing data and dashboards"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Data generated by plugin can be viewed in ",(0,i.kt)("inlineCode",{parentName:"li"},"browse data")," page inside the respective application under ",(0,i.kt)("inlineCode",{parentName:"li"},"plugin=jvm_jolokia")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"documentType=jvm")," "),(0,i.kt)("li",{parentName:"ul"},"Dashboard for this data can be instantiated by Importing dashboard template ",(0,i.kt)("inlineCode",{parentName:"li"},"JVM")," to the application dashboard ")),(0,i.kt)("h3",{id:"troubleshooting"},"Troubleshooting"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Check if the Jolokia port is accessible "),(0,i.kt)("p",{parentName:"li"},"From inside the application container, run a curl command to the userDefinedJolokiaPort."),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"curl http://localhost:<userDefinedJolokiaPort> \n"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Check the logs in sfKubeAgent container for any errors"))),(0,i.kt)("h2",{id:"jvm-monitoring-with-prometheus-exporter"},"JVM Monitoring with Prometheus exporter"),(0,i.kt)("p",null,"Refer to ",(0,i.kt)("a",{parentName:"p",href:"/docs/integrations/kubernetes/prometheus_exporter"},"Prometheus Exporter")," Overview. Prometheus exporter is deployed as a sidecar container in the application pod and connects to the JMX target exposed by the application to scrape the metrics. sfPod polls Prometheus exporter to scrape the metrics. "),(0,i.kt)("h3",{id:"pre-requisites"},"Pre-requisites"),(0,i.kt)("p",null,"sfPod can access Prometheus exporter at Service IP: ",(0,i.kt)("inlineCode",{parentName:"p"},"userDefinedPrometheusPort")),(0,i.kt)("h3",{id:"configurations-1"},"Configurations"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Run Java application with JMX options: "),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre"},"-Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.port= <userDefinedJMXPort> -Dcom.sun.management.jmxremote.authenticate=false - Dcom.sun.management.jmxremote.ssl=false \n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Start the Prometheus exporter with"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre"},"java -jar jmx_prometheus_httpserver.jar <userDefinedPrometheusPort> <exporterConfigFile>\n")),(0,i.kt)("p",{parentName:"li"},"Configurations are passed using config map:"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: v1 \nkind: ConfigMap \nmetadata: \nlabels: \nsnappyflow/appname: <app_name> \nsnappyflow/projectname: <project_name> \ndata: \njmx-config.yaml: | \n--- \njmxUrl: service:jmx:rmi:///jndi/rmi://127.0.0.1:<userDefinedJMXPort>/jmxrmi \nssl: false \nrules: \n- pattern: '.*' \n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Prometheus exporter interfaces to JMX via ",(0,i.kt)("inlineCode",{parentName:"p"},"userDefinedJMXPort"),". Example below uses 555S as the port.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Prometheus exporter exposes ",(0,i.kt)("inlineCode",{parentName:"p"},"userDefinedPrometheusPort")," for scraping. Example uses 5556 as the port ")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Pod definition YAML that illustrates the configuration for Java application and exporter "),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'kind: Pod \napiVersion: v1 \nmetadata: \n name: my-first-pod \nlabels: \nsnappyflow/appname: <app_name> \nsnappyflow/projectname: <project_name> \nspec: \ncontainers: \nname: app-container \nimage: <docker_id>/<docker_image>:<tag> command: \nsh \n-c \n-x \njava -jar -Dcom.sun.management.jmxremote - Dcom.sun.management.jmxremote.port=<userDefinedJMXPort> - Dcom.sun.management.jmxremote.authenticate=false - Dcom.sun.management.jmxremote.ssl=false <application_jar> \nname: "exporter-container" \nimage: "bitnami/jmx-exporter:latest" imagePullPolicy: \ncommand: \nsh \n-c \n-x \njava -jar jmx_prometheus_httpserver.jar <userDefinedPrometheusPort> /tmp/jmx-config.yaml \nports: \nname: exporter-port \ncontainerPort: <userDefinedPrometheusPort> \nvolumeMounts: \nname: configmap-jmx \nmountPath: /tmp \nvolumes: \nname: configmap-jmx configMap: \nname: jmx-configmap \n')))),(0,i.kt)("h3",{id:"viewing-data-and-dashboards-1"},"Viewing data and dashboards"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Data generated by plugin can be viewed in \u201cbrowse data\u201d page inside the respective application under ",(0,i.kt)("inlineCode",{parentName:"li"},"plugin=\u2018kube-prom-jmx\u2018")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"documentType=\u2018jmxStats\u2019")),(0,i.kt)("li",{parentName:"ul"},"Dashboard for this data can be instantiated by Importing dashboard template \u201cJVM\u201d to the application dashboard. ")),(0,i.kt)("h3",{id:"troubleshooting-1"},"Troubleshooting"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Check if the JMX port is accessible .From inside the application container, run a curl command to the ",(0,i.kt)("inlineCode",{parentName:"p"},"userDefinedJMXPort"),"."),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"curl http://localhost:<userDefinedJMXPort> \n"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Check if metrics are getting scraped. From inside the exporter container, run a curl command to the ",(0,i.kt)("inlineCode",{parentName:"p"},"userDefinedPrometheusPort")),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"curl  http://localhost:<userDefinedPrometheusPort>/metrics \n")))))}d.isMDXComponent=!0}}]);