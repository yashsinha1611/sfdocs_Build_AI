"use strict";(self.webpackChunksf_documentation=self.webpackChunksf_documentation||[]).push([[2101],{3905:function(e,t,a){a.d(t,{Zo:function(){return m},kt:function(){return g}});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var p=n.createContext({}),o=function(e){var t=n.useContext(p),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},m=function(e){var t=o(e.components);return n.createElement(p.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,p=e.parentName,m=s(e,["components","mdxType","originalType","parentName"]),c=o(a),g=r,d=c["".concat(p,".").concat(g)]||c[g]||u[g]||i;return a?n.createElement(d,l(l({ref:t},m),{},{components:a})):n.createElement(d,l({ref:t},m))}));function g(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,l=new Array(i);l[0]=c;var s={};for(var p in t)hasOwnProperty.call(t,p)&&(s[p]=t[p]);s.originalType=e,s.mdxType="string"==typeof e?e:r,l[1]=s;for(var o=2;o<i;o++)l[o]=a[o];return n.createElement.apply(null,l)}return n.createElement.apply(null,a)}c.displayName="MDXCreateElement"},9678:function(e,t,a){a.r(t),a.d(t,{assets:function(){return m},contentTitle:function(){return p},default:function(){return g},frontMatter:function(){return s},metadata:function(){return o},toc:function(){return u}});var n=a(3117),r=a(102),i=(a(7294),a(3905)),l=["components"],s={},p="Memory",o={unversionedId:"Integrations/java/java_profiler_memory",id:"Integrations/java/java_profiler_memory",title:"Memory",description:"Heap Analysis",source:"@site/docs/Integrations/java/java_profiler_memory.md",sourceDirName:"Integrations/java",slug:"/Integrations/java/java_profiler_memory",permalink:"/docs/Integrations/java/java_profiler_memory",editUrl:"https://github.com/ram-dot-kumar/SFwebsite.git/docs/Integrations/java/java_profiler_memory.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"CPU Profiling",permalink:"/docs/Integrations/java/java_profiler_cpu"},next:{title:"Jboss plugin",permalink:"/docs/Integrations/jboss"}},m={},u=[{value:"Heap Analysis",id:"heap-analysis",level:2},{value:"Pre-requisites",id:"pre-requisites",level:3},{value:"Heap Analysis",id:"heap-analysis-1",level:2},{value:"Trigger Heap Dump",id:"trigger-heap-dump",level:3},{value:"Remote Processing",id:"remote-processing",level:3},{value:"Viewing Reports",id:"viewing-reports",level:3},{value:"Heap Analysis Support Size Limits",id:"heap-analysis-support-size-limits",level:3},{value:"Java Heap Analysis Troubleshoot Documentation",id:"java-heap-analysis-troubleshoot-documentation",level:3},{value:"Screenshots",id:"screenshots",level:3},{value:"Note",id:"note",level:3}],c={toc:u};function g(e){var t=e.components,a=(0,r.Z)(e,l);return(0,i.kt)("wrapper",(0,n.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"memory"},"Memory"),(0,i.kt)("h2",{id:"heap-analysis"},"Heap Analysis"),(0,i.kt)("h3",{id:"pre-requisites"},"Pre-requisites"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Install Java - JDK 11"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://docs.snappyflow.io/docs/Integrations/os/linux/sfagent_linux"},"Install sfAgent on Linux"))),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("ul",{parentName:"div"},(0,i.kt)("li",{parentName:"ul"},"Add ",(0,i.kt)("strong",{parentName:"li"},"profile key")," and SnappyFlow tags in the config.yaml."),(0,i.kt)("li",{parentName:"ul"},"For ",(0,i.kt)("strong",{parentName:"li"},"existing customers"),", update SFAgent config.yaml with latest - profile key, if SFAgent is already deployed."),(0,i.kt)("li",{parentName:"ul"},"Name and AppName should always be ",(0,i.kt)("strong",{parentName:"li"},"unique")," (pair)."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"jcmd equivalent :")," Application Dashboard >> Process Name")))),(0,i.kt)("h2",{id:"heap-analysis-1"},"Heap Analysis"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Memory profiling provides the heap dump analyses."),(0,i.kt)("li",{parentName:"ul"},"Profiling helps us to identify Memory leaks.")),(0,i.kt)("h3",{id:"trigger-heap-dump"},"Trigger Heap Dump"),(0,i.kt)("p",null,"Select the ",(0,i.kt)("strong",{parentName:"p"},"project")," >> ",(0,i.kt)("strong",{parentName:"p"},"application")," where the instance is monitored"),(0,i.kt)("p",null,"Go to ",(0,i.kt)("strong",{parentName:"p"},"Dashboards")," >> Click on ",(0,i.kt)("strong",{parentName:"p"},"Profiling")," pane >> Click on ",(0,i.kt)("strong",{parentName:"p"},"Configure")," tab >> ",(0,i.kt)("strong",{parentName:"p"},"Generate Heap Dump")," button"),(0,i.kt)("p",null,"Fill the form with following details : "),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Heap Dump Name")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Add tags :")," Provide the tags keys and tags values used to identify the target instance on the which heap dump needs to be triggered."),(0,i.kt)("li",{parentName:"ul"},"To drill down on the process on which heap dump has to be triggered provide the process name in the ",(0,i.kt)("strong",{parentName:"li"},"process name filter"),". If nothing is provided heap dump will be triggered on all java process identified by JCMD command."),(0,i.kt)("li",{parentName:"ul"},"In ",(0,i.kt)("strong",{parentName:"li"},"Configure Schedule")," section : ",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"#Heap Dumps :")," indicate the number of heap dumps to be triggered"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Interval between Heap Dumps :")," indicates the interval between individual heap dumps"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Max wait time :")," indicates the time duration after which if no response is returned from target instances the command is marked invalid")))),(0,i.kt)("p",null,"The command status can be viewed on expanding the ",(0,i.kt)("strong",{parentName:"p"},"command"),". "),(0,i.kt)("p",null,"In the details views, click on the ",(0,i.kt)("strong",{parentName:"p"},"Report")," icon to view the heap dump report."),(0,i.kt)("h3",{id:"remote-processing"},"Remote Processing"),(0,i.kt)("p",null,"Eventhough if the user opts for remote processing, if the heapdump hprof file size is smaller than or equal to the default maximum supported file size, parsing of reports will be done by agent and normal workflow prevails.The following are the environment variables which user can use to override the default values."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"MAXSUPPORTEDSIZEGB"),": To override the default maximum supported heapdump filesize(",(0,i.kt)("strong",{parentName:"p"},"15 % of  Machine's RAM"),")  (eg: ",(0,i.kt)("strong",{parentName:"p"},"MAXSUPPORTEDSIZEGB"),"=2 for 2GB and ",(0,i.kt)("strong",{parentName:"p"},"MAXSUPPORTEDSIZEGB"),"=2.5 for 2.5GB) in ",(0,i.kt)("strong",{parentName:"p"},"/opt/sfagent/env.conf"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"CHUNKSIZEMB"),":  To override the default chunksize value (",(0,i.kt)("strong",{parentName:"p"},"500MB"),")  (eg: ",(0,i.kt)("strong",{parentName:"p"},"CHUNKSIZEMB"),"=1000 for 1GB) in ",(0,i.kt)("strong",{parentName:"p"},"/opt/sfagent/env.conf"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"MEMORYANALYZERMAXHEAPSIZEGB"),": To override the default maxheapsize of memoryanalyser.ini(",(0,i.kt)("strong",{parentName:"p"},"50 % of machine's RAM"),") (eg: ",(0,i.kt)("strong",{parentName:"p"},"MEMORYANALYZERMAXHEAPSIZEGB"),"=2 for 2GB and ",(0,i.kt)("strong",{parentName:"p"},"MEMORYANALYZERMAXHEAPSIZEGB"),"=2.5 for 2.5GB) in ",(0,i.kt)("strong",{parentName:"p"},"/opt/sfagent/env.conf"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"RHPSCLIENTTIMEOUTSEC"),": To override the default RHPS http client timeout (",(0,i.kt)("strong",{parentName:"p"},"300 Seconds"),") (eg: ",(0,i.kt)("strong",{parentName:"p"},"RHPSCLIENTTIMEOUTSEC"),"=500 for 500 seconds)  in ",(0,i.kt)("strong",{parentName:"p"},"/opt/sfagent/env.conf")))),(0,i.kt)("h3",{id:"viewing-reports"},"Viewing Reports"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Click on Reports tab in Profiling Pane"),(0,i.kt)("li",{parentName:"ul"},"Select the Language as Java"),(0,i.kt)("li",{parentName:"ul"},"Select Profiling as Heap analyses"),(0,i.kt)("li",{parentName:"ul"},"Select Instance Name from drop down"),(0,i.kt)("li",{parentName:"ul"},"Select process Name from drop down"),(0,i.kt)("li",{parentName:"ul"},"Select the heapdump from the timeline chart"),(0,i.kt)("li",{parentName:"ul"},"Details of the heapdump can be found in the down panel")),(0,i.kt)("h3",{id:"heap-analysis-support-size-limits"},"Heap Analysis Support Size Limits"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Heap analysis is memory and CPU intensive activity."),(0,i.kt)("li",{parentName:"ul"},"Based on the application memory usage heap dump binary size, processing overhead on the system will also increase on the SFAgent w.r.t CPU and memory.")),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"We successfully tested up to 3.3GB of heap dump size on t2.xlarge (4 vCPU, 16 GiB) instance.")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Here are the resources consumption details :")),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:"center"},"Java Process Max Heap Size"),(0,i.kt)("th",{parentName:"tr",align:"center"},"Eclipse MAT Max Heap Size"),(0,i.kt)("th",{parentName:"tr",align:"center"},"Max Dump Size Created"),(0,i.kt)("th",{parentName:"tr",align:"center"},"Time Taken To Generate Dump (min.)"),(0,i.kt)("th",{parentName:"tr",align:"center"},"Time Taken To Parse Reports (min.)"),(0,i.kt)("th",{parentName:"tr",align:"center"},"System\u2019s Max CPU Usage"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},"1 GB"),(0,i.kt)("td",{parentName:"tr",align:"center"},"8 GB"),(0,i.kt)("td",{parentName:"tr",align:"center"},"1 GB"),(0,i.kt)("td",{parentName:"tr",align:"center"},"0.1"),(0,i.kt)("td",{parentName:"tr",align:"center"},"2.34"),(0,i.kt)("td",{parentName:"tr",align:"center"},"45%")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},"2 GB"),(0,i.kt)("td",{parentName:"tr",align:"center"},"8 GB"),(0,i.kt)("td",{parentName:"tr",align:"center"},"1.7 GB"),(0,i.kt)("td",{parentName:"tr",align:"center"},"0.3"),(0,i.kt)("td",{parentName:"tr",align:"center"},"3.6"),(0,i.kt)("td",{parentName:"tr",align:"center"},"65%")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},"3 GB"),(0,i.kt)("td",{parentName:"tr",align:"center"},"8 GB"),(0,i.kt)("td",{parentName:"tr",align:"center"},"3.1 GB"),(0,i.kt)("td",{parentName:"tr",align:"center"},"0.6"),(0,i.kt)("td",{parentName:"tr",align:"center"},"9.8"),(0,i.kt)("td",{parentName:"tr",align:"center"},"55%")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},"4 GB"),(0,i.kt)("td",{parentName:"tr",align:"center"},"8 GB"),(0,i.kt)("td",{parentName:"tr",align:"center"},"3.3 GB"),(0,i.kt)("td",{parentName:"tr",align:"center"},"0.6"),(0,i.kt)("td",{parentName:"tr",align:"center"},"10.5"),(0,i.kt)("td",{parentName:"tr",align:"center"},"80%")))),(0,i.kt)("h3",{id:"java-heap-analysis-troubleshoot-documentation"},"Java Heap Analysis Troubleshoot Documentation"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Error Message / Status"),(0,i.kt)("th",{parentName:"tr",align:null},"What does it mean? When and why this occurs?"),(0,i.kt)("th",{parentName:"tr",align:null},"What action user can take next?"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"The listed process is not running"),(0,i.kt)("td",{parentName:"tr",align:null},"While generating dump if the mentioned java process is not running in the VM this error will occur."),(0,i.kt)("td",{parentName:"tr",align:null},"Restart the process after investigation.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Unable to get dump exit status 13"),(0,i.kt)("td",{parentName:"tr",align:null},"Occurs while processing the heap dump, if the size of the heap dump is beyond supported limit."),(0,i.kt)("td",{parentName:"tr",align:null},"Refer the supported size limits.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Unknown"),(0,i.kt)("td",{parentName:"tr",align:null},"If SFAgent is failed to update the heap dump processing status with in the maximum wait time, then SnappyFlow backend treat this as stale entry and mark it as Unknown."),(0,i.kt)("td",{parentName:"tr",align:null},"User may increase the \u201cMaximum wait time\u201d while configuring heapdump.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"stat /opt/sfagent/dump_files/",(0,i.kt)("br",null),"Dump_file_141295_1638767771354"),(0,i.kt)("td",{parentName:"tr",align:null},"If SFAgent fails to locate the heap dump file, after triggering the heap dump this may occur.  Possible reason could be process is down."),(0,i.kt)("td",{parentName:"tr",align:null},"Restart the process after investigation.")))),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Here are the details of plugin, indexes and document types involved in heap analysis feature."),(0,i.kt)("li",{parentName:"ul"},"User can view these documents through browse data feature in SF UI.")),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Index"),(0,i.kt)("th",{parentName:"tr",align:null},"Plugin Type"),(0,i.kt)("th",{parentName:"tr",align:null},"Document Type(s)"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Heartbeat"),(0,i.kt)("td",{parentName:"tr",align:null},"HeapDump"),(0,i.kt)("td",{parentName:"tr",align:null},"Command_Events")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Profiling"),(0,i.kt)("td",{parentName:"tr",align:null},"HeapDump"),(0,i.kt)("td",{parentName:"tr",align:null},"Dominator_Class_stats, Shortest_Paths_To_the_Accumulation_Point_stats, class_usage_stats, heap_dump_overview_stats, leak_suspects_stats, All_Accumulated_Objects_by_Class_stats")))),(0,i.kt)("h3",{id:"screenshots"},"Screenshots"),(0,i.kt)("p",null,"List of tags which will be used to filter instances."),(0,i.kt)("img",{src:"/img/screenshots/heap_analysis/1.png"}),(0,i.kt)("br",null),(0,i.kt)("p",null,"Dashboard >> Profiling >> Configure >> Generate Heap Dump"),(0,i.kt)("img",{src:"/img/screenshots/heap_analysis/12.png"}),(0,i.kt)("br",null),(0,i.kt)("img",{src:"/img/screenshots/heap_analysis/13.png"}),(0,i.kt)("br",null),(0,i.kt)("img",{src:"/img/screenshots/heap_analysis/14.png"}),(0,i.kt)("br",null),(0,i.kt)("img",{src:"/img/screenshots/heap_analysis/15.png"}),(0,i.kt)("br",null),(0,i.kt)("p",null,"Dashboard"),(0,i.kt)("img",{src:"/img/screenshots/heap_analysis/2.png"}),(0,i.kt)("br",null),(0,i.kt)("p",null,"You can filter the process name."),(0,i.kt)("img",{src:"/img/screenshots/heap_analysis/4.png"}),(0,i.kt)("br",null),(0,i.kt)("p",null,"Profiling >> Reports >> Select the filters from the options."),(0,i.kt)("img",{src:"/img/screenshots/heap_analysis/5.png"}),(0,i.kt)("br",null),(0,i.kt)("p",null,"Click any heap dump in the graph to see the overview of it."),(0,i.kt)("img",{src:"/img/screenshots/heap_analysis/6.png"}),(0,i.kt)("br",null),(0,i.kt)("img",{src:"/img/screenshots/heap_analysis/7.png"}),(0,i.kt)("br",null),(0,i.kt)("img",{src:"/img/screenshots/heap_analysis/8.png"}),(0,i.kt)("br",null),(0,i.kt)("p",null,"Top Memory leak suspects >> Details"),(0,i.kt)("img",{src:"/img/screenshots/heap_analysis/9.png"}),(0,i.kt)("br",null),(0,i.kt)("img",{src:"/img/screenshots/heap_analysis/10.png"}),(0,i.kt)("br",null),(0,i.kt)("img",{src:"/img/screenshots/heap_analysis/11.png"}),(0,i.kt)("br",null),(0,i.kt)("h3",{id:"note"},"Note"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"User can tag the instances with user defined tags."),(0,i.kt)("li",{parentName:"ul"},"Application : Grouping the instances performing a similar role/purpose (say web service) with user defined tags.")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="config.yaml"',title:'"config.yaml"'},"tags:\n  Name: Custom_log_parser_Test\n  appName: Custom_log_parser_Test\n  projectName: Demo-QA-Apps\n  serviceName: MyService    # user defined tags\n")),(0,i.kt)("img",{src:"/img/screenshots/heap_analysis/16.png"}),(0,i.kt)("img",{src:"/img/screenshots/heap_analysis/17.png"}))}g.isMDXComponent=!0}}]);